<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Financeiro Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui, -apple-system, BlinkMacSystemFont;
  background:#0f172a;
  color:#e5e7eb;
}
.container{
  max-width:480px;
  margin:auto;
  padding:16px;
}
header{
  background:linear-gradient(135deg,#2563eb,#1e40af);
  padding:16px;
  border-radius:14px;
}
h1{margin:0;font-size:20px}
.saldo{
  font-size:28px;
  font-weight:700;
  margin-top:8px;
}
.card{
  background:#111827;
  padding:14px;
  border-radius:14px;
  margin-top:12px;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:white;
  font-size:16px;
  margin-top:8px;
}
button.gray{background:#374151}
button.red{background:#dc2626}
.lista .item{
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid #1f2937;
  padding:10px 0;
}
small{color:#9ca3af}
</style>
</head>

<body>

<div id="lock" class="container" style="display:none">
  <h2>Digite seu PIN</h2>
  <input id="pinInput" type="password" maxlength="4" style="width:100%;padding:14px;font-size:18px">
  <button onclick="checkPin()">Entrar</button>
</div>

<div id="app" class="container">

<header>
  <h1>Financeiro Pro</h1>
  <div class="saldo" id="saldo">R$ 0,00</div>
</header>

<div class="card">
  <button onclick="listen()">üéôÔ∏è Falar lan√ßamento</button>
  <button class="gray" onclick="undo()">‚Ü©Ô∏è Desfazer √∫ltimo</button>
  <button class="gray" onclick="exportPDF()">üìÑ Exportar PDF</button>
</div>

<div class="card">
  <h3>Relat√≥rio do m√™s</h3>
  <div id="report"></div>
</div>

<div class="card lista" id="list"></div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("data")) || [];
let balance = parseFloat(localStorage.getItem("balance")) || 0;

const balanceEl = document.getElementById("saldo");
const listEl = document.getElementById("list");
const reportEl = document.getElementById("report");

function save(){
  localStorage.setItem("data", JSON.stringify(data));
  localStorage.setItem("balance", balance);
}

function render(){
  balanceEl.textContent = "R$ " + balance.toFixed(2);
  listEl.innerHTML = "";
  data.forEach(d=>{
    listEl.innerHTML += `
      <div class="item">
        <div>
          <strong>${d.type.toUpperCase()} - R$ ${d.value.toFixed(2)}</strong><br>
          <small>${d.category}</small>
        </div>
        <small>${new Date(d.date).toLocaleDateString()}</small>
      </div>
    `;
  });
  monthlyReport();
}

function monthlyReport(){
  const now = new Date();
  let income = 0, expense = 0;

  data.forEach(d=>{
    const dt = new Date(d.date);
    if(dt.getMonth() === now.getMonth() && dt.getFullYear() === now.getFullYear()){
      d.type === "income" ? income += d.value : expense += d.value;
    }
  });

  reportEl.innerHTML = `
    Entradas: R$ ${income.toFixed(2)}<br>
    Sa√≠das: R$ ${expense.toFixed(2)}<br>
    Saldo: R$ ${(income - expense).toFixed(2)}
  `;
}

function undo(){
  if(data.length === 0) return;
  const last = data.pop();
  last.type === "income" ? balance -= last.value : balance += last.value;
  save();
  render();
}

function listen(){
  const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  rec.lang = "pt-BR";
  rec.start();

  rec.onresult = e => parseText(e.results[0][0].transcript.toLowerCase());
}

function parseText(text){
  if(/desfazer|cancelar/.test(text)){
    undo();
    return;
  }

  const valueMatch = text.match(/(\d+)/);
  if(!valueMatch) return;

  const value = parseFloat(valueMatch[1]);
  const type = /recebi|ganhei|entrada|sal[a√°]rio/.test(text) ? "income" : "expense";

  let category = "Outros";
  if(/mercado|comida|alimenta/.test(text)) category = "Alimenta√ß√£o";
  if(/aluguel|casa/.test(text)) category = "Moradia";
  if(/sal[a√°]rio/.test(text)) category = "Sal√°rio";
  if(/luz|energia/.test(text)) category = "Energia";

  data.push({ value, type, category, date:new Date() });
  type === "income" ? balance += value : balance -= value;

  save();
  render();
}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  pdf.text("Relat√≥rio Financeiro", 10, 10);
  let y = 20;

  data.forEach(d=>{
    pdf.text(`${d.type} R$ ${d.value} ${d.category}`, 10, y);
    y += 7;
  });

  pdf.save("financeiro.pdf");
}

// PIN simples
const PIN = "1234";
if(localStorage.getItem("pinActive")){
  document.getElementById("app").style.display = "none";
  document.getElementById("lock").style.display = "block";
}

function checkPin(){
  if(document.getElementById("pinInput").value === PIN){
    document.getElementById("lock").style.display = "none";
    document.getElementById("app").style.display = "block";
  }
}

render();
</script>

</body>
</html>
