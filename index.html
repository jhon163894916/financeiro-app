<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Financeiro Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui, -apple-system, BlinkMacSystemFont;
  background:linear-gradient(180deg,#0a1020,#060b18);
  color:#fff;
}
.container{
  max-width:420px;
  margin:auto;
  padding:16px;
}
header{
  background:linear-gradient(135deg,#2563eb,#1e40af);
  padding:20px;
  border-radius:16px;
}
header h1{margin:0;font-size:20px}
#saldo{font-size:32px;font-weight:700;margin-top:6px}
.card{
  background:#111827;
  padding:16px;
  border-radius:14px;
  margin-top:14px;
}
button,input,select{
  width:100%;
  padding:14px;
  margin-top:8px;
  border:none;
  border-radius:12px;
  font-size:16px;
}
button{
  background:#2563eb;
  color:#fff;
  font-weight:600;
}
button.secondary{background:#374151}
button.danger{background:#dc2626}
small{color:#9ca3af}
hr{border:1px solid #1f2937;margin:12px 0}
</style>
</head>

<body>
<div class="container">

<header>
  <h1>Financeiro Pro</h1>
  <div id="saldo">R$ 0,00</div>
</header>

<div class="card">
  <button onclick="ouvir()">üéôÔ∏è Falar lan√ßamento</button>
  <button class="secondary" onclick="desfazer()">‚Ü©Ô∏è Desfazer √∫ltimo</button>
  <button class="secondary" onclick="exportarPDF()">üìÑ Exportar PDF</button>
</div>

<div class="card">
  <strong>Lan√ßamento manual</strong>
  <input id="valorManual" placeholder="Valor (ex: 67,91)">
  <input id="descManual" placeholder="Descri√ß√£o">
  <select id="tipoManual">
    <option value="saida">Sa√≠da</option>
    <option value="entrada">Entrada</option>
  </select>
  <button onclick="manual()">Registrar</button>
</div>

<div class="card">
  <strong>Relat√≥rio do m√™s</strong><br><br>
  Entradas: <span id="ent">R$ 0,00</span><br>
  Sa√≠das: <span id="sai">R$ 0,00</span><br>
  Saldo: <span id="sal">R$ 0,00</span>
</div>

</div>

<script>
const STORAGE = "financeiro_pro_v2";
let dados = JSON.parse(localStorage.getItem(STORAGE)) || [];

function salvar(){localStorage.setItem(STORAGE,JSON.stringify(dados));}

function parseValor(txt){
  txt = txt.toLowerCase()
    .replace("reais","")
    .replace("real","")
    .replace("centavos","")
    .replace("centavo","")
    .replace(" e ",",")
    .replace(".",",");
  let m = txt.match(/(\d+,\d{1,2}|\d+)/);
  return m ? parseFloat(m[0].replace(",",".")) : 0;
}

function detectarTipo(txt){
  if(/recebi|ganhei|entrada|sal√°rio|pix/.test(txt)) return "entrada";
  return "saida";
}

function detectarCategoria(txt){
  if(/mercado|supermercado|comida|aliment/.test(txt)) return "Alimenta√ß√£o";
  if(/aluguel|luz|√°gua|internet/.test(txt)) return "Moradia";
  if(/combust√≠vel|gasolina|√¥nibus|uber/.test(txt)) return "Transporte";
  if(/di√°ria|servi√ßo|trabalho/.test(txt)) return "Renda";
  return "Outros";
}

function registrar(obj){
  dados.push({...obj, data:new Date().toISOString()});
  salvar();
  render();
}

function ouvir(){
  const r = new (window.SpeechRecognition||webkitSpeechRecognition)();
  r.lang="pt-BR";
  r.start();
  r.onresult=e=>{
    const t=e.results[0][0].transcript;
    registrar({
      valor:parseValor(t),
      tipo:detectarTipo(t),
      categoria:detectarCategoria(t),
      descricao:t
    });
  };
}

function manual(){
  const v=parseValor(document.getElementById("valorManual").value);
  if(!v)return;
  registrar({
    valor:v,
    tipo:document.getElementById("tipoManual").value,
    categoria:detectarCategoria(document.getElementById("descManual").value),
    descricao:document.getElementById("descManual").value
  });
}

function desfazer(){
  dados.pop();
  salvar();
  render();
}

function render(){
  let ent=0,sai=0;
  dados.forEach(d=>{
    d.tipo==="entrada"?ent+=d.valor:sai+=d.valor;
  });
  const saldo=ent-sai;
  document.getElementById("saldo").innerText="R$ "+saldo.toFixed(2);
  document.getElementById("ent").innerText="R$ "+ent.toFixed(2);
  document.getElementById("sai").innerText="R$ "+sai.toFixed(2);
  document.getElementById("sal").innerText="R$ "+saldo.toFixed(2);
}
render();

function exportarPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Financeiro Pro",10,10);
  let y=20;
  dados.forEach(d=>{
    pdf.text(`${d.tipo.toUpperCase()} | R$ ${d.valor.toFixed(2)} | ${d.categoria}`,10,y);
    y+=8;
  });
  pdf.save("financeiro.pdf");
}
</script>
</body>
</html>
