<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Financeiro Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0f172a;
  color:#e5e7eb;
}
.container{
  max-width:480px;
  margin:auto;
  padding:16px;
}
header{
  background:linear-gradient(135deg,#2563eb,#1e40af);
  padding:16px;
  border-radius:12px;
}
h1{margin:0;font-size:20px}
.saldo{font-size:28px;font-weight:bold;margin-top:8px}
.card{
  background:#111827;
  padding:14px;
  border-radius:12px;
  margin-top:12px;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  background:#2563eb;
  color:white;
  font-size:16px;
  margin-top:8px;
}
button.red{background:#dc2626}
button.gray{background:#374151}
.lista .item{
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid #1f2933;
  padding:8px 0;
}
small{color:#9ca3af}
</style>
</head>

<body>

<div id="lock" class="container" style="display:none">
  <h2>Digite seu PIN</h2>
  <input id="pinInput" type="password" maxlength="4" style="width:100%;padding:14px;font-size:18px">
  <button onclick="verificarPin()">Entrar</button>
</div>

<div id="app" class="container">

<header>
  <h1>Financeiro Pro</h1>
  <div class="saldo" id="saldo">R$ 0,00</div>
</header>

<div class="card">
  <button onclick="ouvir()">üéôÔ∏è Falar lan√ßamento</button>
  <button class="gray" onclick="desfazer()">‚Ü©Ô∏è Desfazer √∫ltimo</button>
  <button class="gray" onclick="exportarPDF()">üìÑ Exportar PDF</button>
</div>

<div class="card">
  <h3>Relat√≥rio do m√™s</h3>
  <div id="relatorio"></div>
</div>

<div class="card lista" id="lista"></div>

</div>

<script>
let dados = JSON.parse(localStorage.getItem("dados")) || [];
let saldo = parseFloat(localStorage.getItem("saldo")) || 0;

const saldoEl = document.getElementById("saldo");
const listaEl = document.getElementById("lista");
const relatorioEl = document.getElementById("relatorio");

function salvar(){
  localStorage.setItem("dados", JSON.stringify(dados));
  localStorage.setItem("saldo", saldo);
}

function render(){
  saldoEl.textContent = "R$ " + saldo.toFixed(2);
  listaEl.innerHTML = "";
  dados.forEach(d=>{
    listaEl.innerHTML += `
      <div class="item">
        <div>
          <strong>${d.tipo.toUpperCase()} - R$ ${d.valor.toFixed(2)}</strong><br>
          <small>${d.categoria}</small>
        </div>
        <small>${new Date(d.data).toLocaleDateString()}</small>
      </div>
    `;
  });
  gerarRelatorio();
}

function gerarRelatorio(){
  const agora = new Date();
  let entrada = 0, saida = 0;
  dados.forEach(d=>{
    const dt = new Date(d.data);
    if(dt.getMonth()===agora.getMonth() && dt.getFullYear()===agora.getFullYear()){
      d.tipo==="entrada"?entrada+=d.valor:saida+=d.valor;
    }
  });
  relatorioEl.innerHTML = `
    Entradas: R$ ${entrada.toFixed(2)}<br>
    Sa√≠das: R$ ${saida.toFixed(2)}<br>
    Saldo: R$ ${(entrada-saida).toFixed(2)}
  `;
}

function desfazer(){
  if(dados.length===0)return;
  const u = dados.pop();
  u.tipo==="entrada"?saldo-=u.valor:saldo+=u.valor;
  salvar();
  render();
}

function ouvir(){
  const r = new (window.SpeechRecognition||window.webkitSpeechRecognition)();
  r.lang="pt-BR";
  r.start();
  r.onresult=e=>processarTexto(e.results[0][0].transcript.toLowerCase());
}

function processarTexto(t){
  if(/desfazer/.test(t)){desfazer();return;}

  const valorMatch = t.match(/(\d+)/);
  if(!valorMatch)return;

  const valor = parseFloat(valorMatch[1]);
  const tipo = /recebi|ganhei|entrada/.test(t)?"entrada":"saida";

  let categoria="Outros";
  if(/mercado|comida/.test(t))categoria="Alimenta√ß√£o";
  if(/aluguel/.test(t))categoria="Moradia";
  if(/sal[a√°]rio/.test(t))categoria="Sal√°rio";

  dados.push({valor,tipo,categoria,data:new Date()});
  tipo==="entrada"?saldo+=valor:saldo-=valor;

  salvar();
  render();
}

function exportarPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Relat√≥rio Financeiro",10,10);
  let y=20;
  dados.forEach(d=>{
    pdf.text(`${d.tipo} R$${d.valor} ${d.categoria}`,10,y);
    y+=7;
  });
  pdf.save("financeiro.pdf");
}

// PIN simples
const PIN="1234";
if(localStorage.getItem("pinAtivo")){
  document.getElementById("app").style.display="none";
  document.getElementById("lock").style.display="block";
}
function verificarPin(){
  if(document.getElementById("pinInput").value===PIN){
    document.getElementById("lock").style.display="none";
    document.getElementById("app").style.display="block";
  }
}

render();
</script>
</body>
</html>
